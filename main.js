(()=>{"use strict";function e(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&o(t)}}function t(e){var t=document.querySelector(".popup_is-opened");t&&e.target===t&&o(t)}function n(n){n.classList.add("popup_is-opened"),n.classList.add("popup_is-animated"),document.addEventListener("keydown",e),document.addEventListener("mousedown",t)}function o(n){n&&(n.classList.remove("popup_is-opened"),n.classList.add("popup_is-animated"),document.removeEventListener("keydown",e),document.removeEventListener("mousedown",t))}var r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"daed3754-3575-4e1a-a7d0-daae90f95c75","Content-Type":"application/json"}};function c(e,t,n,o,r,c,u,a,i){var l=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0);l.querySelector(".card__title").textContent=e;var s=l.querySelector(".card__image");s.src=t,s.alt=e;var d=l.querySelector(".card__like-count");d.textContent=n;var p=l.querySelector(".card__like-button");return p.addEventListener("click",(function(){a(o,p,d)})),s.addEventListener("click",i),r===c?l.querySelector(".card__delete-button").addEventListener("click",(function(){return u(o,l)})):l.querySelector(".card__delete-button").style.display="none",l}function u(e,t){fetch("https://nomoreparties.co/v1/wff-cohort-26/cards/".concat(e),{method:"DELETE",headers:{authorization:"daed3754-3575-4e1a-a7d0-daae90f95c75","Content-Type":"application/json"}}).then((function(e){e.ok?t.remove():console.error("Ошибка при удалении карточки")})).catch((function(e){console.error("Ошибка:",e)}))}function a(e,t,n){t.classList.contains("card__like-button_is-active")?function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(e).then((function(e){t.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(e).then((function(e){t.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(e){return console.log(e)}))}var i=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o&&(o.textContent=n,o.classList.add("popup__input-error"))},l=function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.classList.remove("popup__input-error"),n.textContent=""},s=/^[a-zA-Zа-яА-ЯёЁ\s-]+$/,d=/^(https?:\/\/)?([\da-z\.-]+\.[a-z\.]{2,6})([\/\w \.-]*)*\/?$/,p=function(e,t){var n=t.dataset.errorMessage||"Поле заполнено некорректно.";t.validity.valueMissing?i(e,t,"Вы пропустили это поле."):"text"!==t.type||s.test(t.value)?"url"!==t.type||d.test(t.value)?l(e,t):i(e,t,"Введите корректный URL."):i(e,t,n)},f=function(e){var t=Array.from(e.querySelectorAll(".popup__input")),n=e.querySelector(".popup__button");t.forEach((function(t){return l(e,t)})),n.removeAttribute("disabled")};function _(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){var t,n;t=e,(n=Array.from(t.querySelectorAll(".popup__input"))).forEach((function(e){e.addEventListener("input",(function(){p(t,e)}))})),t.addEventListener("submit",(function(e){e.preventDefault(),n.forEach((function(e){p(t,e)}))}))})),Promise.all([fetch("".concat(r.baseUrl,"/users/me"),{method:"GET",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){return console.log(e)})),fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,u,a=[],i=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(a.push(o.value),a.length!==t);i=!0);}catch(e){l=!0,r=e}finally{try{if(!i&&null!=n.return&&(u=n.return(),Object(u)!==u))return}finally{if(l)throw r}}return a}}(t,n)||function(e,t){if(e){if("string"==typeof e)return _(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],i=o[1],l=r._id;P.textContent=r.name,T.textContent=r.about,y.style.backgroundImage="url(".concat(r.avatar,")"),i.forEach((function(e){var t=c(e.name,e.link,e.likes.length,e._id,e.owner._id,l,u,a,I);b.append(t)}))})).catch((function(e){return console.log(e)}));var y=document.querySelector(".profile__image");y.style.backgroundImage="url(".concat("6666407ac3aa5af1d5de.jpg",")");var m=document.querySelector(".popup_type_edit"),h=document.querySelector(".popup_type_new-card"),v=document.querySelector(".profile__edit-button"),S=document.querySelector(".profile__add-button"),b=document.querySelector(".places__list"),g=document.querySelectorAll(".popup__close");document.querySelector(".profile__avatar").addEventListener("click",(function(){n(E)}));var q=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_avatar"),L=document.querySelector(".popup__form"),C=L.querySelector(".popup__input"),j=q.querySelector(".popup__input_type_card-name"),x=q.querySelector(".popup__input_type_url"),A=k.querySelector(".popup__input_type_name"),w=k.querySelector(".popup__input_type_description"),P=document.querySelector(".profile__title"),T=document.querySelector(".profile__description"),U=document.querySelector(".popup_type_image"),O=U.querySelector(".popup__image"),D=U.querySelector(".popup__caption");function I(e){var t=e.target;O.src=t.src,O.alt=t.alt,D.textContent=t.alt,n(U)}v.addEventListener("click",(function(){A.value=P.textContent,w.value=T.textContent,n(m)})),S.addEventListener("click",(function(){n(h)})),C.addEventListener("input",(function(){p(L,C)})),k.addEventListener("click",(function(){f(k)})),q.addEventListener("click",(function(){f(q)})),E.addEventListener("click",(function(){f(E)})),g.forEach((function(e){e.addEventListener("click",(function(){o(e.closest(".popup"))}))})),k.addEventListener("submit",(function(e){e.preventDefault();var t=A.value,n=w.value,c=k.querySelector(".popup__button");c.textContent="Сохранение...",function(e,t){return fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){return console.log(e)}))}(t,n).then((function(e){P.textContent=e.name,T.textContent=e.about,o(k)})).catch((function(e){return console.log(e)})).finally((function(){c.textContent="Сохранить"}))})),q.addEventListener("submit",(function(e){e.preventDefault();var t,n,i=j.value,l=x.value,s=k.querySelector(".popup__button");s.textContent="Сохранение...",(t=i,n=l,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){return console.log(e)}))).then((function(e){var t=c(e.name,e.link,u,a,I);b.prepend(t),o(q),j.value="",x.value=""})).catch((function(e){return console.log(e)})).finally((function(){s.textContent="Сохранить"}))})),E.addEventListener("submit",(function(e){e.preventDefault();var t=E.querySelector("#avatar-link").value,n=k.querySelector(".popup__button");n.textContent="Сохранение...",function(e){return fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return console.log(e),e})).catch((function(e){return console.log(e)}))}(t).then((function(e){y.style.backgroundImage="url(".concat(e.avatar,")"),o(E)})).catch((function(e){return console.log(e)})).finally((function(){n.textContent="Сохранить"}))}))})();